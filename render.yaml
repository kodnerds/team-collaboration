# yaml-language-server: $schema=https://raw.githubusercontent.com/render-oss/blueprint-spec/main/schema.json
# Render Blueprint - Infrastructure as Code
# See: https://render.com/docs/blueprint-spec

databases:
  - name: team-collaboration-db
    databaseName: team_collaboration
    user: tc_user
    plan: free

services:
  # API Web Service (Docker)
  - type: web
    name: team-collaboration-api
    runtime: docker
    dockerfilePath: apps/api/Dockerfile
    dockerContext: .
    plan: free # Change to 'starter' or higher for production
    region: oregon
    healthCheckPath: /api/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: team-collaboration-db
          property: connectionString
      - key: POSTGRES_HOST
        fromDatabase:
          name: team-collaboration-db
          property: host
      - key: POSTGRES_PORT
        fromDatabase:
          name: team-collaboration-db
          property: port
      - key: POSTGRES_USER
        fromDatabase:
          name: team-collaboration-db
          property: user
      - key: POSTGRES_PASSWORD
        fromDatabase:
          name: team-collaboration-db
          property: password
      - key: POSTGRES_DB
        fromDatabase:
          name: team-collaboration-db
          property: database
      - key: ACCESS_TOKEN_SECRET
        generateValue: true
      - key: LOG_LEVEL
        value: info

  # Web Static Site (Vite/React)
  - type: web
    name: team-collaboration-web
    runtime: static
    buildCommand: npm install && npm run build --workspace=@tc/web
    staticPublishPath: apps/web/dist
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      # IMPORTANT: After Blueprint creation, update this with your actual API URL
      # Example: https://team-collaboration-api.onrender.com
      - key: VITE_API_URL
        value: https://team-collaboration-api.onrender.com
